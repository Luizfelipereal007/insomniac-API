name: Keep API awake

on:
  schedule:
    # Roda no início de cada hora entre 10:00 e 22:00 UTC (06h–18h Manaus)
    - cron: "0 10-22 * * 1-6"
  workflow_dispatch:

jobs:
  keep-awake:
    runs-on: ubuntu-latest

    steps:
    - name: Loop de 6 execuções (10 minutos cada)
      run: |
        echo "Iniciando ciclo de 1 hora (6x execuções a cada 10 min)"
        echo "Horário inicial: $(date)"

        for i in {1..6}; do
          echo ""
          echo "=== Execução $i de 6 ==="
          echo "Ping em: $(date)"

          response=$(curl -s -o /dev/null -w "%{http_code}" https://api-crm-b8fi.onrender.com/)
          echo "Código HTTP: $response"

          if [ "$response" -eq 200 ]; then
            echo "✔️ API respondeu normalmente (200 OK)"
          else
            echo "⚠️ API retornou $response"
          fi

          # Espera 10 minutos (pula na última rodada)
          if [ "$i" -lt 6 ]; then
            echo "Aguardando 10 minutos antes da próxima execução..."
            sleep 600
          fi
        done

        echo ""
        echo "Finalizado às: $(date)"
